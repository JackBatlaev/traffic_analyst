# traffic_analyst

Анализатор сетевого трафика, написанный на C с использованием библиотеки libpcap.

## Описание

Программа предназначена для захвата и анализа сетевых пакетов.
На текущий момент реализован захват пакетов, отображение информации об интерфейсах и базовый разбор заголовков Ethernet и IPv4.

## История версий

### Версия 0.5 (ДД.ММ.ГГГГ)
*   **Реализован разбор IPv4-заголовков:**
    *   Создан новый модуль `ip_parser` (`ip_parser.c` и `ip_parser.h`) для инкапсуляции логики разбора IP.
    *   В `ip_parser.h` определена структура `ipv4_parse_result_t` для возврата результатов парсинга, включая указатель на данные следующего уровня (транспортного), их доступную длину и тип протокола транспортного уровня.
    *   Функция `parse_ipv4_header` выполняет следующие действия:
        *   Извлекает и проверяет поля "Версия" (должна быть 4) и "Длина интернет-заголовка" (IHL).
        *   Вычисляет фактическую длину IP-заголовка в байтах (с учетом возможных опций).
        *   Проверяет, что длина пакета достаточна для чтения полного IP-заголовка.
        *   Извлекает и отображает основные поля IPv4-заголовка:
            *   Версия, Длина заголовка (IHL).
            *   Тип сервиса (TOS).
            *   Общая длина IP-пакета (с преобразованием из сетевого порядка байт).
            *   Идентификатор пакета (с преобразованием).
            *   Время жизни (TTL).
            *   Протокол транспортного уровня (с идентификацией TCP, UDP, ICMP).
            *   Контрольная сумма заголовка (с преобразованием).
            *   IP-адрес источника (с преобразованием в строковый формат).
            *   IP-адрес назначения (с преобразованием в строковый формат).
        *   Определяет наличие и длину опциональной части IP-заголовка.
    *   В `packet_handler` (в ветке для EtherType IPv4) теперь вызывается `parse_ipv4_header`.
    *   Добавлена базовая логика (`switch` по протоколу из IPv4-заголовка) в `packet_handler` для определения следующего протокола (TCP, UDP, ICMP) и подготовки к его разбору.
    *   Временно неиспользуемые переменные для данных следующего уровня корректно "заглушены".

### Версия 0.4 (ДД.ММ.ГГГГ)
*   **Реализован разбор Ethernet-заголовков:**
    *   Создан новый модуль `ethernet_parser` (`ethernet_parser.c` и `ethernet_parser.h`).
    *   В `ethernet_parser.h` определена структура `parsed_ethernet_header_t`.
    *   Функция `parse_ethernet_header` извлекает и отображает MAC-адреса (источник, назначение) и EtherType (с идентификацией IPv4, IPv6, ARP).
    *   `packet_handler` вызывает `parse_ethernet_header`.
    *   Добавлена базовая логика (`switch` по EtherType) в `packet_handler`.

### Версия 0.3 (ДД.ММ.ГГГГ)
*   **Улучшенное отображение времени захвата пакетов:**
    *   Время выводится в формате `ГГГГ-ММ-ДД ЧЧ:ММ:СС.микросекунды`.
*   **Отображение MAC-адресов интерфейсов:**
    *   Реализована функция `print_mac_address_sysfs` (для Linux).
    *   Добавлена обработка `AF_PACKET` в `print_addresses`.
*   **Прочие улучшения:**
    *   Включен `#include <linux/if_packet.h>`.

### Версия 0.2 (ДД.ММ.ГГГГ)
*   Реструктуризация проекта: модули, `Makefile` (исправлен `clean`).
*   Добавлена функция отображения IP-адресов интерфейсов.
*   Улучшен выбор активного интерфейса.

### Версия 0.1 (ДД.ММ.ГГГГ)
*   Начальная версия: захват пакетов, отображение длины и времени.

---

## Планы на будущее (TODO)

*   [x] Реализовать парсинг Ethernet-заголовков.
*   [x] Реализовать парсинг IP-заголовков (IPv4). <!-- Отметили IPv4 как сделанный -->
*   [ ] Реализовать парсинг IPv6-заголовков. <!-- Добавили как отдельный пункт -->
*   [ ] Реализовать парсинг TCP-заголовков.
*   [ ] Реализовать парсинг UDP-заголовков.
*   [ ] Реализовать парсинг ICMP-сообщений. <!-- Добавили как отдельный пункт -->
*   [ ] Добавить возможность выбора интерфейса пользователем.
*   [ ] Добавить возможность применения фильтров захвата (BPF).
*   [ ] Сохранение захваченных пакетов в файл .pcap.
*   [ ] Статистика по протоколам.
*   [ ] Обработка опций IP-заголовка (если потребуется).
